# 更新日志

## [0.3.3] - 2026-02-03

### 新增
- 📊 **推理置信度产物与索引**:
    - 推理完成后自动生成 `metrics.json` / `segments.json`
    - 结果写入 `inference_results` / `segment_scores` 索引表
- 🧲 **候选队列与筛选**:
    - 支持置信度筛选、排序与 TopK/低置信度/随机抽样
- ✅ **审核队列**:
    - 支持抽样入队、状态流转、批量审核与进度统计
- 🧾 **索引回填脚本**:
    - 扫描历史 CSV 生成指标并批量入库
- 🎯 **训练导出仅保留审核通过**:
    - 导出时只保留 `approved` 标注（单用户 MVP）

### 优化
- 🔎 **Annotator API**:
    - 支持按 `min_score/max_score/method/score_by` 过滤
- 📂 **审核项自动定位 CSV**:
    - 标注审核根据文件名推断 CSV 路径并自动加载

## [0.3.2] - 2026-02-02

### 优化
- 🧭 **训练界面筛选**:
    - 新增训练方式过滤（lora/full/all），模板列表不再拥挤
    - 模型类型与训练方式联动，快速切换训练模板
- 🧩 **LoRA 适配器选择**:
    - 适配器选择改为“训练任务 + Checkpoint（可选）”两级
    - 默认不展示 checkpoint，降低噪音
- ⚖️ **模型对比筛选**:
    - 新增模型类型/训练方式/是否包含 checkpoint 过滤

## [0.3.1] - 2026-01-28

### 新增
- 🔄 **数据闭环自动化**:
    - **自动生图**: 数据采集脚本 (`get_downsampled.py`) 支持同步生成图片至 `/home/share/data/images`
    - **智能回退**: Qwen 格式转换时若缺失图片，自动查找源 CSV 并补全生成，无需人工干预
- 🧱 **标注文件索引**:
    - **注册表**: 后端新增文件注册表与白名单目录限制
    - **一键修复**: 提供“重建索引”接口与前端按钮
- 🧰 **数据处理脚本**:
    - **统一入口**: 新增 `run_pipeline.py`（ChatTS）与 `fix_annotation_filenames.py`
    - **智能匹配**: 转换脚本支持模糊匹配 CSV/图片并自动命名输出（含数量与日期）
- ⚡ **体验优化**:
    - **秒级预览**: 数据获取界面优先加载预生成图片，大幅提升预览响应速度
    - **引导式报错**: 转换缺失源文件时提供明确的修复指引

### 优化
- 🔧 **代码重构**: 
    - 消除 `get_downsampled.py` 中的图片路径硬编码，统一受控于全局配置
- 🔁 **输出路径回显**:
    - 转换输出路径以脚本实际输出为准，UI 读取正确文件

## [0.3.0] - 2026-01-28

### 新增
- 🤖 **Qwen-VL 多模态检测**:
    - **推理集成**: 支持 Qwen2-VL-7B-Instruct 模型进行异常检测
    - **标注支持**: 标注工具支持 "Qwen" 算法预标注结果展示
    - **训练配置**: 新增 `DATA_TRAINING_QWEN_IMAGES_DIR` 路径配置支持图片数据
- 🛠️ **数据转换 UI**:
    - **动态配置**: ChatTS/Qwen 转换时自动切换 "Data Dir" / "Image Dir" 标签

### 优化
- 🏗️ **项目结构重构**:
    - **配置整合**: 合并 `config/` 至 `configs/`，统一管理全局配置
    - **代码清理**: 移除 `services/training/` 下的垃圾日志和临时脚本
    - **Inference 整理**: 重组 `services/inference/`，新建 `scripts/` 和 `tests/` 目录
    - **数据路径重构**: 
        - 拆分训练数据至 `services/training/data/{chatts,qwen}`
        - 新增独立图片源目录 `/home/share/data/images`
- 🔧 **代码质量**:
    - **硬编码修复**: 消除 `training_ui.py` 和 `chatts_training.py` 中的用户路径和 IP 硬编码
    - **Annotator 修复**: 解决前端新建标注无法显示的问题，修复标签保存逻辑

### 变更
- `config/iotdb_config.json` -> `configs/iotdb_config.json`
- `settings.py` 新增 `DEFAULT_USER` 和 `WEBUI_HOST` 配置项

## [0.2.3] - 2026-01-27

### 新增
- 📁 **数据链路优化**:
    - **统一命名规范**: 新格式 `{PointID}_{StartTime}_{EndTime}_{Algorithm}.csv`
    - **共享 IoTDB 配置**: `config/iotdb_config.json` 统一管理连接参数
    - **Level 3 兜底机制**: 文件缺失时自动从 IoTDB 重新拉取
    - **统一数据源**: 推理监控与数据获取共享文件列表
- 🛠️ **数据修复工具**: `scripts/repair_data.py` 批量修复旧数据文件命名

## [0.2.2] - 2026-01-23

### 新增
- 🏷️ **标注增强 (Annotator)**:
    - **CSV 自动可视化**: 打开无标注的 CSV 文件时，自动解析 `global_mask` 列并渲染异常区域。
    - **动态算法标签**: 新增 "算法结果/ChatTS" 标签分类（粉紫色），用于区分算法预标注与人工标注。
- 🛠️ **推理集成**:
    - **结果自动同步**: 推理任务生成的 CSV 文件会自动软链接至用户默认工作空间 (`Data/`)，实现“即生成即见”。

## [0.2.1] - 2026-01-23

### 优化
- 🔍 **推理监控 UI**: 
    - 改进文件管理：支持批量删除（带持久化验证）和批量下载
    - 优化下载体验：清晰的引导文案和动态交互
    - 修复任务停止功能：更可靠的任务取消反馈逻辑
    - 界面精简：任务历史放入折叠面板，统一文件操作入口

## [0.2.0] - 2026-01-20

### 新增
- 📁 **数据获取 Tab**: 数据集列表、曲线预览、IoTDB 采集配置
- 🔍 **推理监控 Tab**: 任务创建、状态监控、结果预览
- 🏷️ **标注工具 Tab**: 跳转链接、使用说明
- 🔄 **迭代版本管理 API**: CRUD 接口 `/api/v1/iteration`

### 变更
- 重构 `training_ui.py` 为统一管理界面，包含 7 个 Tab
- 更新 DEVELOPMENT.md 文档

---

## [0.1.0] - 2026-01-20

### 新增
- 项目初始化，创建目录结构
- FastAPI 后端框架
- 数据服务、标注服务、微调服务、推理服务 API
- Gradio 微调界面
- Celery 任务队列
- 推理结果自动反馈闭环

---

## 版本说明

版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范。

- **MAJOR**: 不兼容的 API 变更
- **MINOR**: 向下兼容的功能新增
- **PATCH**: 向下兼容的问题修复
