# 时序数据标注工具 - 功能列表

## 一、核心功能

### 1. 数据管理

| 功能 | 描述 | V1 | V2 | TRAINSET |
|------|------|:--:|:--:|:--------:|
| 服务器路径浏览 | 浏览服务器端目录结构 | ✓ | ✓ | ✗ |
| 本地文件上传 | 上传CSV文件到浏览器 | ✗ | ✓ | ✓ |
| 多格式支持 | 支持CSV/XLS/XLSX | ✓ | ✓ | ✗ |
| 文件列表管理 | 显示目录下的数据文件 | ✓ | ✓ | ✗ |
| 标注计数显示 | 显示每个文件的标注数量 | ✓ | ✓ | ✗ |

### 2. 数据可视化

| 功能 | 描述 | V1 | V2 | TRAINSET |
|------|------|:--:|:--:|:--------:|
| 时序曲线展示 | 显示时间序列折线图 | ✓ | ✓ | ✓ |
| 缩放平移 | 支持图表缩放和平移 | ✓ | ✓ | ✓ |
| 选区高亮 | 框选区域高亮显示 | ✓ | ✓ | ✓ |
| Context Bar | 缩略图导航条 | ✓ | ✓ | ✓ |
| 多系列支持 | 同时显示多条序列 | ✗ | ✗ | ✓ |
| 参考序列 | 显示对比参考序列 | ✗ | ✗ | ✓ |
| 鼠标悬停信息 | 显示点位坐标/值 | ✓ | ✓ | ✓ |

### 3. 标签系统

| 功能 | 描述 | V1 | V2 | TRAINSET |
|------|------|:--:|:--:|:--------:|
| 预设标签 | 内置分类标签体系 | ✓ | ✓ | ✗ |
| 层级标签 | 分类→子类→标签 | ✓ | ✓ | ✗ |
| 自定义标签 | 用户添加新标签 | ✓ | ✓ | ✓ |
| 标签颜色 | 局部变化标签带颜色 | ✓ | ✗ | ✓ |
| 标签删除 | 删除自定义标签 | ✗ | ✗ | ✓ |

### 4. 标注功能

| 功能 | 描述 | V1 | V2 | TRAINSET |
|------|------|:--:|:--:|:--------:|
| 区域选择 | 框选时间区间 | ✓ | ✓ | ✓ |
| 点击标注 | 单击切换点位标签 | ✗ | ✗ | ✓ |
| 批量标注 | 拖拽批量标注 | ✗ | ✗ | ✓ |
| 标注列表 | 显示所有标注 | ✓ | ✓ | ✗ |
| 标注编辑 | 编辑已有标注 | ✓ | ✓ | ✗ |
| 标注删除 | 删除单个/批量标注 | ✓ | ✓ | ✓ |
| 问题描述 | 输入Input Prompt | ✓ | ✓ | ✗ |
| 专家分析 | 输入Expert Output | ✓ | ✓ | ✗ |

### 5. 数据导出

| 功能 | 描述 | V1 | V2 | TRAINSET |
|------|------|:--:|:--:|:--------:|
| JSON导出 | 导出标注JSON文件 | ✓ | ✓ | ✓ |
| CSV导出 | 导出带标签的CSV | ✗ | ✗ | ✓ |
| 自动保存 | 服务端持久化存储 | ✓ | ✓ | ✗ |

---

## 二、目标功能（已实现）

### 2.1 核心标注流程
- [x] 拖拽框选时间区间
- [x] 整体属性标签选择（单选）
- [x] 局部变化标签选择（多选+颜色）
- [x] 自定义标签输入（带颜色选择器）
- [x] Input Prompt 描述输入
- [x] Expert Output 分析输入
- [x] 保存标注到服务端
- [x] 标注列表实时同步

### 2.2 数据可视化
- [x] 主图表：交互式时序曲线
- [x] 缩略图Context Bar导航
- [x] 选区高亮与颜色同步
- [x] 多标注区域可视化
- [x] 键盘快捷键支持 (部分)

### 2.3 标签管理
- [x] 从labels.json加载预设标签
- [x] 整体属性分类展示（趋势/周期/频率/噪声）
- [x] 局部变化分类展示（尖峰/突变/凸起/模式）
- [x] 标签颜色自定义
- [x] 自定义标签持久化

### 2.4 数据管理
- [x] 服务器目录浏览器
- [x] 多文件批量处理
- [x] 标注进度跟踪
- [x] 文件标注状态指示

### 2.5 导出格式
```json
{
  "annotations": [{
    "categories": {
      "trend": { "name": "趋势", "labels": [...] },
      "seasonal": { "name": "周期性", "labels": [...] }
    },
    "local_change": {
      "name": "局部变化",
      "categories": {
        "spike": {
          "name": "尖峰类",
          "labels": [{
            "id": "upward_spike",
            "text": "上行尖峰",
            "color": "#ef4444",
            "index": [1820, 2561],
            "input": "Supposing that...",
            "output": "Yes, the observed series..."
          }]
        }
      }
    }
  }],
  "export_time": "2025-12-21T00:55:29",
  "filename": "dataset.csv"
}
```

### 2.6 工作区与交互 (New)
- [x] **工作区状态管理**：区分查看模式、编辑模式与新建模式，防止误操作。
- [x] **智能填充 (Smart Fill)**：在编辑模式下，框选图表自动填充当前正在编辑的数据段，避免重复创建。
- [x] **交互保护**：在查看模式下锁定图表颜色，防止 D3 刷选导致颜色重置。

### 2.7 平台集成 (New)
- [x] **推理结果集成**：支持加载大模型推理结果并自动转换为标注格式。
- [x] **后端健壮性**：增强文件系统交互，自动处理缺失文件及断裂的符号链接，防止服务崩溃。
- [x] **标注-训练闭环**：与 ChatTS 训练平台打通，实现数据获取 -> 标注 -> 训练 -> 推理的完整闭环。

---

## 三、技术架构

### 前端
- Vue.js 2.x (兼容TRAINSET组件)
- D3.js V5+ 定制化时序图表
- Element UI 组件库
- 响应式三栏布局

### 后端
- Flask REST API (Annotator Service)
- FastAPI (Training/Inference Service)
- Pandas 数据处理
- JSON 标注存储
- SQLite/IoTDB 数据源支持

### 集成目标
- 使用TRAINSET交互模式（拖拽选区、点击标注）
- 使用V1后端API（路径管理、标注存储）
- 输出符合ChatTS训练格式的JSON
