# TS-Iteration-Loop

æ—¶åºå¼‚å¸¸æ£€æµ‹è¿­ä»£å¾ªç¯ç³»ç»Ÿ - é›†æˆæ•°æ®é‡‡é›†ã€æ ‡æ³¨ã€æ¨¡å‹å¾®è°ƒå’Œæ¨ç†çš„ Monorepo é¡¹ç›®ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“ **æ•°æ®è·å–**: IoTDB æ•°æ®é‡‡é›†ã€é™é‡‡æ ·
- ğŸ·ï¸ **æ•°æ®æ ‡æ³¨**: Web æ ‡æ³¨ç•Œé¢ï¼Œæ”¯æŒæ—¶åºå¼‚å¸¸åŒºé—´æ ‡æ³¨
- ğŸ¯ **æ¨¡å‹è®­ç»ƒ**: LlamaFactory å¾®è°ƒæ¡†æ¶ï¼Œæ”¯æŒ LoRA/QLoRA
- ğŸ” **æ¨ç†æ£€æµ‹**: ChatTS å¤§æ¨¡å‹å¼‚å¸¸æ£€æµ‹
- ğŸ¤– **å¤šæ¨¡æ€æ£€æµ‹**: Qwen-VL è§†è§‰è¯­è¨€æ¨¡å‹å¼‚å¸¸æ£€æµ‹
- ğŸ“Š **ç‰ˆæœ¬ç®¡ç†**: æ¨¡å‹ç‰ˆæœ¬è¿½è¸ªã€Loss å¯¹æ¯”
- ğŸ› ï¸ **æ•°æ®å·¥å…·**: å…±äº«é…ç½®ã€Level 3 å…†åº•ã€æ‰¹é‡ä¿®å¤

## å¿«é€Ÿå¼€å§‹

### æœ¬åœ°å¼€å‘

```bash
# ä¸€é”®æ­å»ºå¼€å‘ç¯å¢ƒ
chmod +x scripts/setup_dev.sh
./scripts/setup_dev.sh

# æ¿€æ´»ç¯å¢ƒå¹¶å¯åŠ¨
conda activate ts-iteration-loop
python -m src.main
```

### Docker éƒ¨ç½²

```bash
# å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
docker-compose -f docker-compose.dev.yml up --build

# ç”Ÿäº§æ¨¡å¼
docker-compose up --build -d
```

### è®¿é—®åœ°å€

- **API æ–‡æ¡£**: http://localhost:8000/docs
- **ç®¡ç†ç•Œé¢**: http://localhost:8000/train-ui

## é¡¹ç›®ç»“æ„

```
ts-iteration-loop/
â”œâ”€â”€ src/                    # æ ¸å¿ƒåº”ç”¨ä»£ç 
â”‚   â”œâ”€â”€ api/                # FastAPI è·¯ç”±
â”‚   â”œâ”€â”€ adapters/           # æ¨¡å—é€‚é…å™¨
â”‚   â””â”€â”€ webui/              # Gradio ç•Œé¢
â”œâ”€â”€ services/               # æ•´åˆçš„å­æ¨¡å—
â”‚   â”œâ”€â”€ inference/          # æ¨ç†æ£€æµ‹
â”‚   â”œâ”€â”€ training/           # æ¨¡å‹è®­ç»ƒ (LlamaFactory)
â”‚   â”œâ”€â”€ data_processing/    # æ•°æ®å¤„ç†
â”‚   â””â”€â”€ annotator/          # æ ‡æ³¨å·¥å…·
â”œâ”€â”€ envs/                   # ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ environment.yml     # Conda ç¯å¢ƒ
â”‚   â””â”€â”€ requirements.txt    # pip ä¾èµ–
â”œâ”€â”€ docker/                 # Docker é…ç½®
â””â”€â”€ scripts/                # è„šæœ¬å·¥å…·
```

## æŠ€æœ¯æ ˆä¸ç¯å¢ƒæ¶æ„ (Architecture)

ä¸ºè§£å†³å¤§æ¨¡å‹è®­ç»ƒ(Training)ä¸æ¨ç†(Inference)å¯¹ `transformers` ç­‰åº“çš„ç‰ˆæœ¬å†²çªé—®é¢˜ï¼Œæœ¬é¡¹ç›®é‡‡ç”¨ **å¾®æœåŠ¡åŒ–ç¯å¢ƒéš”ç¦» (Environment Isolation)** ç­–ç•¥ï¼š

| æ¨¡å— | æ¨èç¯å¢ƒ | å…³é”®ä¾èµ– | è¯´æ˜ |
|------|---------|---------|------|
| **WebUI / Backend** | `ts-iteration-loop` | `fastapi`, `gradio`, `celery` | è´Ÿè´£ä»»åŠ¡è°ƒåº¦ã€ç•Œé¢å±•ç¤ºã€è¿›ç¨‹ç®¡ç† |
| **Inference (æ¨ç†)** | `chatts` (æˆ–å¤ç”¨ä¸»ç¯å¢ƒ) | `transformers>=4.40`, `torch` | éœ€è¦æ”¯æŒæœ€æ–°æ¨¡å‹æ¶æ„ |
| **Training (è®­ç»ƒ)** | `llama_factory_env` | `transformers<=4.34/4.54`, `trl` | ä¸¥æ ¼ä¾èµ– LLaMA-Factory çš„ç‰ˆæœ¬è¦æ±‚ |

**æ³¨æ„**ï¼šåœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼Œå¦‚æœç‰ˆæœ¬å…¼å®¹ï¼Œå…è®¸ä½¿ç”¨ç»Ÿä¸€ç¯å¢ƒ (`ts-iteration-loop`)ï¼Œä½†éœ€é€šè¿‡ `DISABLE_VERSION_CHECK=1` ç­‰æ‰‹æ®µè§£å†³å†²çªã€‚

## é…ç½®

ç¼–è¾‘ `configs/settings.py` æˆ–é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ï¼š

| ç¯å¢ƒå˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|----------|------|--------|
| `USE_LOCAL_MODULES` | ä½¿ç”¨æœ¬åœ° services/ æ¨¡å— | `True` |
| `DEBUG` | è°ƒè¯•æ¨¡å¼ | `True` |
| `API_PORT` | æœåŠ¡ç«¯å£ | `8000` |

## æ–‡æ¡£

- [å¼€å‘æ–‡æ¡£](docs/DEVELOPMENT.md)
- [API æ–‡æ¡£](docs/API.md)
- [æ›´æ–°æ—¥å¿—](docs/CHANGELOG.md)

## ç‰ˆæœ¬

- **v0.3.0** - Qwen-VL å¤šæ¨¡æ€å¼‚å¸¸æ£€æµ‹é›†æˆ (2026-01-27)
- **v0.2.3** - æ•°æ®é“¾è·¯ä¼˜åŒ– (2026-01-27)
- **v0.2.1** - æ¨ç† UI äº¤äº’ä½“éªŒä¼˜åŒ– (2026-01-23)
- **v0.2.0** - Monorepo æ•´åˆé‡æ„
- **v0.1.0** - MVP å®Œæˆ
